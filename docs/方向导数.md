## 一、方向导数的定义

方向导数衡量的是多元函数在**指定方向**上的变化率。

对于函数 $ z = f(x, y) $ 在点 $ P(x_0, y_0) $ 处，沿单位向量 $ \mathbf{u} = (a, b) $ 的方向导数定义为：

$$
D_{\mathbf{u}}f(x_0, y_0) = \lim_{h \to 0} \frac{f(x_0 + ha, y_0 + hb) - f(x_0, y_0)}{h}
$$

其中 $ \|\mathbf{u}\| = \sqrt{a^2 + b^2} = 1 $。

---

## 二、方向导数公式的推导

### 步骤1：建立单变量函数

当固定点 $ P(x_0, y_0) $ 和方向 $ \mathbf{u} = (a, b) $ 后，我们沿着这个方向移动。定义一个新的单变量函数：

$$
g(h) = f(x_0 + ha, y_0 + hb)
$$

这个函数表示：从点 $ P $ 出发，沿着方向 $ \mathbf{u} $ 移动距离 $ h $ 后，函数 $ f $ 的值。

### 步骤2：应用方向导数定义

根据方向导数的定义：

$$
D_{\mathbf{u}}f(x_0, y_0) = \lim_{h \to 0} \frac{g(h) - g(0)}{h} = g'(0)
$$

所以，**方向导数就是函数 $ g(h) $ 在 $ h = 0 $ 处的导数**。

### 步骤3：使用链式法则求导

现在对 $ g(h) = f(x_0 + ha, y_0 + hb) $ 求导。设：
- $ x(h) = x_0 + ha $
- $ y(h) = y_0 + hb $

则 $ g(h) = f(x(h), y(h)) $。

应用多元函数的链式法则：
$$
g'(h) = \frac{\partial f}{\partial x} \cdot \frac{dx}{dh} + \frac{\partial f}{\partial y} \cdot \frac{dy}{dh}
$$

其中：
- $ \frac{dx}{dh} = a $
- $ \frac{dy}{dh} = b $

所以：
$$
g'(h) = f_x(x(h), y(h)) \cdot a + f_y(x(h), y(h)) \cdot b
$$

### 步骤4：计算在 $ h = 0 $ 处的值

当 $ h = 0 $ 时：
- $ x(0) = x_0 $
- $ y(0) = y_0 $

因此：
$$
D_{\mathbf{u}}f(x_0, y_0) = g'(0) = f_x(x_0, y_0) \cdot a + f_y(x_0, y_0) \cdot b
$$

### 步骤5：写成向量形式

由于 $ \mathbf{u} = (a, b) $ 是单位向量，梯度 $ \nabla f = (f_x, f_y) $，所以：

$$
D_{\mathbf{u}}f(x_0, y_0) = \nabla f(x_0, y_0) \cdot \mathbf{u}
$$

---

## 三、推导总结

**方向导数公式**：
$$
D_{\mathbf{u}}f(P) = \nabla f(P) \cdot \mathbf{u} = f_x(P)a + f_y(P)b
$$

其中：
- $ P $ 是给定的点
- $ \mathbf{u} = (a, b) $ 是单位方向向量
- $ \nabla f = (f_x, f_y) $ 是梯度

---

## 四、举例说明

**例子**：求函数 $ f(x, y) = x^2 + 3xy $ 在点 $ (1, 2) $ 处沿方向 $ \mathbf{u} = \left( \frac{3}{5}, \frac{4}{5} \right) $ 的方向导数。

### 解法1：使用定义（验证公式）

1. **计算函数值**：
   - $ f(1, 2) = 1^2 + 3 \cdot 1 \cdot 2 = 1 + 6 = 7 $

2. **计算移动后的函数值**：
   沿方向 $ \mathbf{u} $ 移动距离 $ h $：
   - $ x = 1 + h \cdot \frac{3}{5} $
   - $ y = 2 + h \cdot \frac{4}{5} $
   
   $$
   \begin{aligned}
   f\left(1 + \frac{3h}{5}, 2 + \frac{4h}{5}\right) &= \left(1 + \frac{3h}{5}\right)^2 + 3\left(1 + \frac{3h}{5}\right)\left(2 + \frac{4h}{5}\right) \\
   &= 1 + \frac{6h}{5} + \frac{9h^2}{25} + 6 + \frac{12h}{5} + \frac{12h}{5} + \frac{36h^2}{25} \\
   &= 7 + \frac{30h}{5} + \frac{45h^2}{25} \\
   &= 7 + 6h + \frac{9h^2}{5}
   \end{aligned}
   $$

3. **应用定义**：
   $$
   \begin{aligned}
   D_{\mathbf{u}}f(1,2) &= \lim_{h \to 0} \frac{f\left(1 + \frac{3h}{5}, 2 + \frac{4h}{5}\right) - f(1,2)}{h} \\
   &= \lim_{h \to 0} \frac{7 + 6h + \frac{9h^2}{5} - 7}{h} \\
   &= \lim_{h \to 0} \left(6 + \frac{9h}{5}\right) = 6
   \end{aligned}
   $$

### 解法2：使用方向导数公式

1. **计算偏导数**：
   $$
   \begin{aligned}
   f_x &= 2x + 3y \\
   f_y &= 3x
   \end{aligned}
   $$

   在点 $ (1, 2) $ 处：
   $$
   \begin{aligned}
   f_x(1,2) &= 2 \cdot 1 + 3 \cdot 2 = 2 + 6 = 8 \\
   f_y(1,2) &= 3 \cdot 1 = 3
   \end{aligned}
   $$

2. **应用公式**：
   $$
   \begin{aligned}
   D_{\mathbf{u}}f(1,2) &= f_x(1,2) \cdot a + f_y(1,2) \cdot b \\
   &= 8 \cdot \frac{3}{5} + 3 \cdot \frac{4}{5} \\
   &= \frac{24}{5} + \frac{12}{5} = \frac{36}{5} = 7.2
   \end{aligned}
   $$

### 结果分析

两种方法得到了不同的结果（6 vs 7.2），这是因为在解法1中我犯了一个计算错误。让我们重新计算解法1：

**重新计算解法1**：
$$
\begin{aligned}
f\left(1 + \frac{3h}{5}, 2 + \frac{4h}{5}\right) &= \left(1 + \frac{3h}{5}\right)^2 + 3\left(1 + \frac{3h}{5}\right)\left(2 + \frac{4h}{5}\right) \\
&= 1 + \frac{6h}{5} + \frac{9h^2}{25} + 6 + \frac{12h}{5} + \frac{12h}{5} + \frac{36h^2}{25} \quad \text{（这里展开有误）}
\end{aligned}
$$

**正确展开**：
$$
\begin{aligned}
3\left(1 + \frac{3h}{5}\right)\left(2 + \frac{4h}{5}\right) &= 3\left(2 + \frac{4h}{5} + \frac{6h}{5} + \frac{12h^2}{25}\right) \\
&= 6 + \frac{12h}{5} + \frac{18h}{5} + \frac{36h^2}{25} \\
&= 6 + \frac{30h}{5} + \frac{36h^2}{25} \\
&= 6 + 6h + \frac{36h^2}{25}
\end{aligned}
$$

所以：
$$
\begin{aligned}
f\left(1 + \frac{3h}{5}, 2 + \frac{4h}{5}\right) &= \left(1 + \frac{6h}{5} + \frac{9h^2}{25}\right) + \left(6 + 6h + \frac{36h^2}{25}\right) \\
&= 7 + \frac{6h}{5} + 6h + \frac{45h^2}{25} \\
&= 7 + \frac{36h}{5} + \frac{9h^2}{5}
\end{aligned}
$$

**应用定义**：
$$
\begin{aligned}
D_{\mathbf{u}}f(1,2) &= \lim_{h \to 0} \frac{7 + \frac{36h}{5} + \frac{9h^2}{5} - 7}{h} \\
&= \lim_{h \to 0} \left(\frac{36}{5} + \frac{9h}{5}\right) = \frac{36}{5} = 7.2
\end{aligned}
$$

现在两种方法得到一致的结果：**方向导数为 7.2**。

---

## 五、几何解释

方向导数的几何意义是：函数曲面在给定点处，沿指定方向的**斜率**。

- 当方向向量 $ \mathbf{u} $ 与梯度方向一致时，方向导数最大（最陡上坡）
- 当方向向量 $ \mathbf{u} $ 与梯度方向相反时，方向导数最小（最陡下坡）
- 当方向向量 $ \mathbf{u} $ 与梯度方向垂直时，方向导数为零（沿等高线移动）

通过这个推导过程，我们可以清楚地看到方向导数如何从基本定义出发，通过链式法则，最终得到与梯度相关的简洁公式。